<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Midterm</title>
</head>
<body>
    <select class="dict">
        <option value="">請選擇地區</option>
    </select>  

    <select class="type">
        <option value="">請選擇類型</option>
    </select>

    <input type="button" value="搜尋" class="btn">

    <h3 class="title"></h3>

    <ul class="list"></ul>

    <script> 

        var xhr = new XMLHttpRequest();
        xhr.open("GET", "https://work1999.kcg.gov.tw/open1999/ServiceRequestsQuery.asmx/ServiceRequestsQuery", true);
        xhr.send();
        var data = JSON.parse(xhr.responseText);
        // xhr.onload = function() {
        //     var data = JSON.parse(xhr.responseText);
        // }


        var district = [];
        var types = [];

        for (var i=0;data.length>i;i++) {
            if (district.includes(data[i].ZipName_)) {
                continue;
            } else {
                district.push(data[i].ZipName_);
            }
        }

        for (var i=0;district.length>i;i++) {
            document.querySelector('.dict').innerHTML += '<option value=' + district[i] + '>' + districet[i] + '</option>';
        }

        for (var i=0;data.length>i;i++) {
            if (types.includes(data[i].InformDesc_)) {
                continue;
            } else {
                types.push(data[i].InformDesc_);
            }
        }
        
        for (var i=0;types.length>i;i++) {
            document.querySelector('.type').innerHTML += '<option value='+types[i]+'>'+types[i]+'</option>';
        }

        document.querySelector(".btn").addEventListener("click", function(e) {
            var str = '';
            var count = 0;
            var _district = document.querySelector('.dict').value;
            var _types = document.querySelector('.type').value;

            for (var i=0;data.length>i;i++) {
                if (data[i].ZipName_ == _district && data[i].InformDesc_ == _types) {
                    count++;
                    str += '<li>' + '<h4>地點：' + data[i].ZipName_ + data[i].address_ + '</h4><h5>報案狀況：' + data[i].BeforeDesc_ + '</h5></li>';
                }
            }
            document.querySelector('.title').innerHTML = _district + " " + _types + "有" + count + "處";
            document.querySelector('.list').innerHTML = str;
        });
    </script>

</body>
</html>